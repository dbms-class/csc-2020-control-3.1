# Третья контрольная курса Базы Данных в CSC
Контрольная работа модуля №3. Вариант 1




### Инициализация БД
по умолчанию пользователь postgres с пустым паролем на localhost:5432/postgres

```
psql -h localhost -U postgres -f marsoflot.sql
```

### Запуск приложения
```
python3 app.py
```

Если нужно поменять хост, порт, пользователя, базу данных или пароль, воспользуйтесь аргументами командной строки. `python3 app.py -h`  вам про них расскажут.

### Как сдавать
Пул-реквест в репозиторий `github.com/dbms-class/csc-2020-control-3.1` или письмо с заархивированным кодом на `dmitry+csc@barashev.net`. Пожалуйста, не присылайте в архиве каталоги `build`, `.gradle` и `.idea` 

### Грачев А.В., Отчёт

#### connect.py
Добавил ```putconn``` для пулла коннекций

#### model.py
##### TickerEntity.set_discount
1. конструкция ```with``` не освобождает коннекции (можно или написать свой менеджер контекта или сделать ```try ... finally```)
2. транзакция не коммитится (по-дефолту автокоммит выключен) 

#### app.py
##### /cache_flights
1. конструкция ```with``` не освобождает коннекции (можно или написать свой менеджер контекта или сделать ```try ... finally```)
2. генерирует шторм запросов: соединение полета с планетой по одному. // не успел нормально это исправить :(

##### /flights

1. генерирует шторм запросов: подтягивание полей планет через ```ForeignKeyField``` во ```FlightEntity```

##### /delay_flights
1. конструкция ```with``` не освобождает коннекции (можно или написать свой менеджер контекта или сделать ```try ... finally```)
2. транзакция не коммитится (по-дефолту автокоммит выключен) 
##### /delete_planet
1. транзакция не коммитится (по-дефолту автокоммит выключен) 
2. коннекция закрывается при помощи ```db.close()```, но ```getconn()``` возвращает коннекцию из пула 
   (которую нужно закрывать через ```putconn(db)```)